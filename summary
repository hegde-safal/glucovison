# Project Summary for IEEE Report Generation

## 1. Project Overview
**Name:** GlucoVision
**Description:** An AI-powered nutritional analysis platform designed to help individuals monitor and manage their glycaemic health. It transforms natural language meal logs into actionable, medical-grade dietary insights using NLP and RAG.

## 2. Key Features
-   **Medical-Grade Interface:** Clean, accessible UI.
-   **AI-Powered Food Analysis:**
    -   **NLP Parsing:** Extracts food items and quantities from text (e.g., "bowl of oatmeal").
    -   **Fuzzy Matching:** Matches inputs against a local database (6,000+ items) using `rapidfuzz`.
    -   **API Fallback:** Uses Edamam Nutrition API for unmatched items.
-   **Intelligent Risk Assessment:**
    -   Calculates total sugar, carbs, fiber, protein, and fat.
    -   Assigns Glycaemic Risk Level (Safe, Moderate, High) based on WHO-aligned thresholds.
-   **RAG-Enhanced Suggestions:**
    -   Generates personalized, science-backed dietary adjustments using Groq (Llama 3).
    -   Context-aware suggestions based on specific nutrient imbalances.
-   **Privacy & Storage:**
    -   Local SQLite database for history/logs.
    -   Privacy-first approach with local data storage.

## 3. Technology Stack
-   **Backend:** Python (Flask)
-   **Frontend:** HTML5, CSS3, JavaScript (Vanilla), Chart.js
-   **Database:** SQLite (`nutrition.db`)
-   **Data Source:** `nutrition_master.csv` (CSV based master data)
-   **AI/NLP Libraries:**
    -   `spacy` (en_core_web_sm) for parsing.
    -   `rapidfuzz` for string matching.
    -   `groq` SDK for LLM integration.

## 4. System Architecture & Components

### A. NLP Engine (`app/nlp.py`)
-   **Library:** SpaCy
-   **Function:** `parse_meals(text)`
-   **Logic:**
    -   Tokenizes input text.
    -   Identifies quantities (numbers) and units (cup, slice, etc.).
    -   Extracts food entities using noun chunks and dependency parsing.
    -   Handles "unit of item" patterns (e.g., "slice of cheesecake").
    -   Cleans stop words to normalize food names.

### B. Nutrition Engine (`app/nutrition.py`)
-   **Data Loading:** Loads `nutrition_master.csv` into a Pandas DataFrame.
-   **Data Patching:** Applies runtime patches for known bad data (e.g., zero sugar entries for fruits).
-   **Matching Logic:**
    -   primary: `fuzzy_match` using `rapidfuzz.process.extractOne` with `WRatio` scorer. Threshold: 80.
    -   secondary: Edamam API (`fetch_from_api`) if local match fails or if local data is suspicious (e.g., 0 sugar for non-sugar-free item).
-   **Risk Calculation (`calculate_risk`):**
    -   **Safe:** Sugar â‰¤ 40g.
    -   **Moderate:** Sugar 40-65g OR Carbs 150-250g.
    -   **High:** Sugar > 65g OR Carbs > 250g.
-   **Analysis:** Aggregates totals for calories, carbs, sugar, protein, fat, fiber.

### C. RAG Engine (`app/rag.py`)
-   **Model:** Llama-3.3-70b-versatile via Groq API.
-   **Context:** Injects clinical guidelines (Activity, Hydration, Sequencing, Swaps, Portion Control).
-   **Prompting:**
    -   Acts as a senior clinical nutritionist.
    -   Receives patient nutrient totals and risk level.
    -   Outputs JSON with 5 actionable suggestions and 3-4 analytical reasons.
-   **Fallback:** Provides safe, generic advice if API is unavailable.
-   **Weekly Context:** Generates textual summary of weekly trends (e.g., "Sugar intake exceeded safe limit on 3 days").

### D. Web Application (`app/routes.py`)
-   **Framework:** Flask
-   **Endpoints:**
    -   `/`: Dashboard.
    -   `/analyze` (POST): Main pipeline trigger (NLP -> Nutrition -> Risk -> RAG).
    -   `/history`: View past logs.
    -   `/api/stats/weekly`: JSON data for Chart.js visualizations.
    -   `/settings`: User configuration (Name, Sugar Limits).

## 5. Workflow Summary
1.  **User Input:** User enters meal description (e.g., "2 slices of pizza and a coke").
2.  **Parsing:** NLP Engine breaks this down into `[("pizza", 2), ("coke", 1)]`.
3.  **Nutritional Lookup:**
    -   "pizza" matched locally -> Nutritional info retrieved.
    -   "coke" matched locally -> Nutritional info retrieved.
4.  **Aggregation:** System calculates total macros (Sugar: 60g, etc.).
5.  **Risk Assessment:** Logic determines "Moderate Risk" (Sugar between 40-65g).
6.  **Suggestion Generation:** RAG Engine sends data to LLM, receiving advice like "Drink water to aid glucose excretion" and "Walk for 15 mins".
7.  **Response:** Frontend displays totals, risk gauge, and AI suggestions.
